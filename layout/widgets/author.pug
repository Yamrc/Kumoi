- const bgRaw = theme.components && theme.components.author && theme.components.author.background && theme.components.author.background.light
- const bgDarkRaw = theme.components && theme.components.author && theme.components.author.background && theme.components.author.background.dark
- const bgImg = (bgRaw && String(bgRaw).trim()) || undefined
- const bgImgDark = (bgDarkRaw && String(bgDarkRaw).trim()) || undefined

section.widget.widget-author.card-info.text-center(data-bg=bgImg data-bg-dark=bgImgDark)
	.avatar-img
		img(src=url_for(theme.site && theme.site.avatar) onerror="this.style.display='none'" alt="avatar")
	.author-info-name= config.author || config.title
	.author-info-description!= config.description
	.site-data
		a(href=url_for(config.archive_dir))
			.headline= __('aside.articles')
			.length-num= site.posts.length
		a(href=url_for(config.tag_dir))
			.headline= __('aside.tags')
			.length-num= site.tags.length
		a(href=url_for(config.category_dir))
			.headline= __('aside.categories')
			.length-num= site.categories.length
	if theme.components && theme.components.author && theme.components.author.author_button && theme.components.author.author_button.enabled
		a#card-info-btn(href=theme.components.author.author_button.url)
			if theme.components.author.author_button.icon
				i(class=theme.components.author.author_button.icon)
			span= theme.components.author.author_button.text
	if theme.components && theme.components.author && Array.isArray(theme.components.author.social)
		- const social = theme.components.author.social.filter(s => s && s.icon && s.url)
		.card-info-social-icons
			each s in social
				- const colorRaw = (s.color && String(s.color).replace(/['"]/g, '')) || ''
				- const pair = colorRaw.split(',').map(i => i.trim())
				- const colorLight = pair[0] || ''
				- const colorDark = pair[1] || ''
				a.social-icon(
					href=url_for(s.url)
					target="_blank"
					title=(s.title || '')
					style=(colorLight ? `color: ${colorLight};` : '')
					data-color=colorLight
					data-color-dark=colorDark
				)
					i(class=s.icon)
script.
	(function(){
		var el = document.querySelector('section.widget.widget-author.card-info');
		if (!el) return;
		var links = el.querySelectorAll('.card-info-social-icons a.social-icon');
		function apply(mode) {
			mode = mode || (document.documentElement.getAttribute('data-theme') || 'light');
			var url = mode === 'dark' ? el.getAttribute('data-bg-dark') : el.getAttribute('data-bg');
			el.style.backgroundImage = url ? ('url(' + url + ')') : '';
			links.forEach(function(a){
				var cl = a.dataset.color || '';
				var cd = a.dataset.colorDark || '';
				var chosen = mode === 'dark' ? (cd || cl) : (cl || cd);
				a.style.color = chosen || '';
			});
		}
		apply();
		window.addEventListener('themechange', function(e){
			apply(e && e.detail && e.detail.mode);
		});
	})();

- const bgRaw = theme.components && theme.components.author && theme.components.author.background && theme.components.author.background.light
- const bgDarkRaw = theme.components && theme.components.author && theme.components.author.background && theme.components.author.background.dark
- const bgImg = (bgRaw && String(bgRaw).trim()) || undefined
- const bgImgDark = (bgDarkRaw && String(bgDarkRaw).trim()) || undefined

section.widget.widget-author.card-info.text-center(data-bg=bgImg data-bg-dark=bgImgDark)
	.avatar-img
		img(src=url_for(theme.site && theme.site.avatar) onerror="this.style.display='none'" alt="avatar")
	.author-info-name= config.author || config.title
	.author-info-description!= config.description
	.site-data
		a(href=url_for(config.archive_dir))
			.headline= __('aside.articles')
			.length-num= site.posts.length
		a(href=url_for(config.tag_dir))
			.headline= __('aside.tags')
			.length-num= site.tags.length
		a(href=url_for(config.category_dir))
			.headline= __('aside.categories')
			.length-num= site.categories.length
	if theme.components && theme.components.author && theme.components.author.author_button && theme.components.author.author_button.enabled
		a#card-info-btn(href=theme.components.author.author_button.url)
			if theme.components.author.author_button.icon
				i(class=theme.components.author.author_button.icon)
			span= theme.components.author.author_button.text
	if theme.components && theme.components.author && theme.components.author.social
		.card-info-social-icons
			each url, icon in theme.components.author.social
				- const [link, title, color] = (url || '').split('||').map(i => i.trim())
				- const href = url_for(link || '#')
				- const iconStyle = color ? `color: ${color.replace(/['"]/g, '')};` : ''
				- const iconTitle = title || ''
				a.social-icon(href=href target="_blank" title=iconTitle style=iconStyle)
					i(class=icon)
script.
	(function(){
		var el = document.querySelector('section.widget.widget-author.card-info');
		if (!el) return;
		function apply() {
			var mode = document.documentElement.getAttribute('data-theme') || 'light';
			var url = mode === 'dark' ? el.getAttribute('data-bg-dark') : el.getAttribute('data-bg');
			el.style.backgroundImage = url ? ('url(' + url + ')') : '';
		}
		apply();
		var prev = window.onThemeChange;
		window.onThemeChange = function(mode){
			if (typeof prev === 'function') prev(mode);
			apply();
		};
	})();
